{% extends 'base.html' %}
{% block title %}Agregar aviso{% endblock %}
{% block content %}
  <h1>Agregar aviso de adopción</h1>

  {% if errores %}
    <div class="errors">
      <ul>
        {% for e in errores %}<li>{{ e }}</li>{% endfor %}
      </ul>
    </div>
  {% endif %}

  <form id="form-aviso"
        method="POST"
        action="{{ url_for('crear_aviso') }}"
        enctype="multipart/form-data"
        novalidate>
    <fieldset>
      <legend>Ubicación</legend>

      <label for="region">Región</label>
      <select id="region" name="region">
        <option value="">Seleccione</option>
      </select>

      <label for="comuna_id">Comuna</label>
      <select id="comuna_id" name="comuna_id" required>
        <option value="">Seleccione</option>
      </select>

      <label for="sector">Sector</label>
      <input type="text" id="sector" name="sector"
             maxlength="100"
             value="{{ (data.get('sector') if data else '') }}">
    </fieldset>

    <fieldset>
      <legend>Contacto</legend>

      <label for="nombre">Nombre</label>
      <input id="nombre" name="nombre" required maxlength="200"
             value="{{ (data.get('nombre') if data else '') }}">

      <label for="email">Email</label>
      <input id="email" name="email" type="email" required maxlength="100"
             value="{{ (data.get('email') if data else '') }}">

      <label for="celular">Celular</label>
      <input id="celular" name="celular" maxlength="12"
             placeholder="+569XXXXXXXX"
             value="{{ (data.get('celular') if data else '') }}">
    </fieldset>

    <fieldset>
      <legend>Detalle del aviso</legend>

      <label for="tipo">Tipo</label>
      <select id="tipo" name="tipo" required>
        <option value="">Seleccione</option>
        <option value="gato" {{ 'selected' if data and data.get('tipo')=='gato' }}>Gato</option>
        <option value="perro" {{ 'selected' if data and data.get('tipo')=='perro' }}>Perro</option>
      </select>

      <label for="cantidad">Cantidad</label>
      <input id="cantidad" name="cantidad" required
             value="{{ (data.get('cantidad') if data else '') }}">

      <div class="fila">
        <div>
          <label for="edad">Edad</label>
          <input id="edad" name="edad" required
                 value="{{ (data.get('edad') if data else '') }}">
        </div>
        <div>
          <label for="unidad_medida">Unidad</label>
          <select id="unidad_medida" name="unidad_medida" required>
            <option value="a" {{ 'selected' if data and data.get('unidad_medida')=='a' }}>Años</option>
            <option value="m" {{ 'selected' if data and data.get('unidad_medida')=='m' }}>Meses</option>
          </select>
        </div>
      </div>

      <label for="fecha_entrega">Fecha de entrega</label>
      <input type="datetime-local" id="fecha_entrega" name="fecha_entrega" required
             value="{{ (data.get('fecha_entrega') if data else '') }}">

      <label for="descripcion">Descripción</label>
      <textarea id="descripcion" name="descripcion" maxlength="500">{{ (data.get('descripcion') if data else '') }}</textarea>
    </fieldset>

    <fieldset>
      <legend>Fotos</legend>
      <input type="file" name="fotos" id="fotos" multiple accept=".jpg,.jpeg,.png,.webp">
    </fieldset>

    <fieldset>
      <legend>Métodos de contacto</legend>
      {% set filas = contactos if contactos is defined else [('', '')] %}
      <div id="contactos">
        {% for metodo, identificador in filas %}
          <div class="contacto-row">
            <select name="metodo[]">
              <option value="">Seleccione</option>
              <option value="whatsapp" {{ 'selected' if metodo == 'whatsapp' }}>WhatsApp</option>
              <option value="telegram" {{ 'selected' if metodo == 'telegram' }}>Telegram</option>
              <option value="X" {{ 'selected' if metodo == 'X' }}>X</option>
              <option value="instagram" {{ 'selected' if metodo == 'instagram' }}>Instagram</option>
              <option value="tiktok" {{ 'selected' if metodo == 'tiktok' }}>TikTok</option>
              <option value="otra" {{ 'selected' if metodo == 'otra' }}>Otra</option>
            </select>
            <input name="identificador[]" placeholder="@usuario o numero" value="{{ identificador }}">
          </div>
        {% endfor %}
      </div>
    </fieldset>

    <button type="submit">Agregar este aviso de adopción</button>
  </form>
{% endblock %}